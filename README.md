# AngularProtobufExample
Since it took myself a bit to figure out how to integrate google protobuf generated JS classes into an angular TS project, I condensed my solution into this little sample project. If you found a better solution on this, please feel free to share ;) 

This project was generated with [Angular CLI](https://github.com/angular/angular-cli) version 1.0.0.

## Steps to make google protobuf work with your angular app
Hint: The as-is state of this repo reflects the outcome of the following steps. If you simply wanna run this project, skip to the next section.

Assuming that you start with a seed project generated by `ng new <project-name>`, you first of all install the google protocol buffers runtime library: `npm install google-protobuf --save`. This will allow you to use your generated _pb.js classes within your project. Next, you create your protobuf schema file. Please take the file located at `./src/proto/schemas.proto` as an example. Importing protobuf in typescript using `import * as goog from 'google-protobuf';` initially gave me a transpiler error. Declaring the module in `./src/typings.d.ts` like so `declare module 'google-protobuf';` resolved the issue.

If you do not have the protobuf compiler installed, find the latest version via [Google Developers](https://developers.google.com/protocol-buffers/docs/downloads) and make it available in your PATH such that you can use it as `protoc` from your shell. At the time of writing, this is [protoc-3.0.0-win32.zip](https://github.com/google/protobuf/releases/download/v3.0.0/protoc-3.0.0-win32.zip) if you're developing on a windows machine (which I usually don't but have to right now because I am at work). For the sake of completeness: [protoc-3.0.0-linux-x86_64.zip](https://github.com/google/protobuf/releases/download/v3.0.0/protoc-3.0.0-linux-x86_64.zip), [protoc-3.0.0-osx-x86_64.zip](https://github.com/google/protobuf/releases/download/v3.0.0/protoc-3.0.0-osx-x86_64.zip)

Before we actually touch our angular code, we need to generate our protobuf classes. In a full-fledged development environment, you'd ideally integrate this step into your build process.
WINDOWS: `protoc --proto_path=src\proto\ --js_out=import_style=commonjs,binary:src\assets\js src\proto\schemas.proto`
UNIX: `protoc --proto_path=./src/proto/ --js_out=import_style=commonjs,binary:./src/assets/js ./src/proto/schemas.proto`

As the generated files are in plain old javascript, we still need to instruct our typescript transpiler to allow javascript imports. We do so by setting `allowJs` in the compilerOptions of `./src/tsconfig.app.json` and `./src/tsconfig.spec.json` to `true` (and optionally also in the root level tsconfig.json - if you don't want your IDE rant about the js imports).

The component `./src/app/app.component.ts` and the protobuf service `./src/app/core/protobuf.service.ts` should make clear how to use protobuf. I couldn't find another way of importing the generated protbuf classes than doing the following (happy to learn about a better way tho):

``` 
declare function require(path: string) : any;
let proto = require('../../assets/js/schemas_pb.js');

```

## Run the project
`npm install`
`ng serve`